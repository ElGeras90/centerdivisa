<div class="container-fluid mt-4 cuerpo px-3 px-md-4">
  <!-- Toolbar -->
  <div
    class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-3">
    <div class="d-flex gap-2 w-100 w-md-auto align-items-center">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Buscar</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Buscar por nombre, correo o tel√©fono">
        <button mat-icon-button matSuffix *ngIf="false"><mat-icon>search</mat-icon></button>
      </mat-form-field>
    </div>

    <div class="d-flex gap-2 justify-content-end w-100 w-md-auto">


      <button class="btn btn-primary d-flex align-items-center" (click)="abrirwill()">
        <i class="bi bi-person-plus-fill me-2"></i> Agregar Cliente
      </button>
    </div>
  </div>

  <!-- Tabla dentro de card -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z2 table table-borderless align-middle mb-0">
          <!-- Nombre -->
          <ng-container matColumnDef="Nombre">
            <th mat-header-cell *matHeaderCellDef class="table-header">Nombre</th>
            <td mat-cell *matCellDef="let row">
              <div class="d-flex align-items-center gap-3">
                <div class="avatar bg-light rounded-circle text-center">
                  <i class="bi bi-person-fill fs-5 text-primary"></i>
                </div>
                <div>
                  <div class="fw-semibold">{{ row.nombre }}</div>
                  <div class="small text-muted">{{ row.paterno }} {{ row.materno }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Telefono -->
          <ng-container matColumnDef="Telefono">
            <th mat-header-cell *matHeaderCellDef class="table-header">Tel√©fono</th>
            <td mat-cell *matCellDef="let row"> {{ row.telefono || '-' }} </td>
          </ng-container>

          <!-- Correo -->
          <ng-container matColumnDef="correo">
            <th mat-header-cell *matHeaderCellDef class="table-header">Correo</th>
            <td mat-cell *matCellDef="let row"> {{ row.correo || '-' }} </td>
          </ng-container>

          <!-- Calle / Direcci√≥n -->
          <ng-container matColumnDef="calle">
            <th mat-header-cell *matHeaderCellDef class="table-header">Direcci√≥n</th>
            <td mat-cell *matCellDef="let row">
              <div class="small text-truncate" style="max-width:360px;">{{ row.direccion || '-' }}</div>
            </td>
          </ng-container>

          <!-- Acciones -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef class="table-header text-end">Acciones</th>
            <td mat-cell *matCellDef="let row" class="text-end">
              <button mat-icon-button color="primary" class="btn-action me-1" (click)="abrirupdate(row)" title="Editar">
                <mat-icon>edit</mat-icon>
              </button>

              <button mat-icon-button color="accent" class="btn-action me-1" *ngIf="status==true"
                (click)="cargardatos(row)" title="Seleccionar">
                <mat-icon>person_check</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-row-header"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center p-3 border-top small bg-light">

        <div>
          <mat-paginator *ngIf="!activar" [pageSizeOptions]="[5, 10, 25, 50]" showFirstLastButtons></mat-paginator>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Clientes Fisicos Extranjeros -->
<div class="modal fade" bsModal #will="bs-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h4 class="modal-title" *ngIf="info">Agregar USUARIO</h4>
        <h4 class="modal-title" *ngIf="!info">EDITAR USUARIO</h4>
        <button class="btn btn-warning ms-auto">Riesgo: {{riesgos}}</button>
      </div>

      <div class="modal-body">
        <form class="form-responsive">
          <!-- üîπ DATOS PERSONALES -->
          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light fw-bold">Datos Personales</div>
            <div class="card-body">
              <div class="row g-3">
                <div class="form-group col-md-4">
                  <label>Nombre:</label>
                  <input type="text" class="form-control" name="nombres" [(ngModel)]="nombres"
                    [ngClass]="{'campo-rojo': formulario && formulario.nombres}" />
                </div>
                <div class="form-group col-md-4">
                  <label>Apellido Paterno:</label>
                  <input type="text" class="form-control" name="paterno" [(ngModel)]="paterno"
                    [ngClass]="{'campo-rojo': formulario && formulario.paterno}" />
                </div>
                <div class="form-group col-md-4">
                  <label>Apellido Materno:</label>
                  <input type="text" class="form-control" name="materno" [(ngModel)]="materno"
                    [ngClass]="{'campo-rojo': formulario && formulario.materno}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Pa√≠s de nacimiento:</label>
                  <select class="form-control" name="paisnaci" (change)="estados($event)" [(ngModel)]="paisnaci"
                    [ngClass]="{'campo-rojo': formulario && formulario.paisnaci}">
                    <option *ngFor="let item of paises" [value]="item.idpais">{{ item.nombre }}</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label>Estado Nacimiento:</label>
                  <select class="form-control" name="estanaci" [(ngModel)]="estanaci"
                    [ngClass]="{'campo-rojo': formulario && formulario.estanaci}">
                    <option *ngFor="let item of estadosselect" [value]="item.idcatest">{{ item.nombre }}</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label>Nacionalidad:</label>
                  <select class="form-control" name="nacionalidad" [(ngModel)]="nacionalidad"
                    [ngClass]="{'campo-rojo': formulario && formulario.nacionalidad}"
                    (change)="getnacionalidad($event)">
                    <option *ngFor="let item of nacionalidades" [value]="item.idnaci">{{ item.nacionalidad }}</option>
                  </select>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Fecha de nacimiento:</label>
                  <input type="date" class="form-control" name="fechanacimiento" [(ngModel)]="fechanacimiento"
                    [ngClass]="{'campo-rojo': formulario && formulario.fechanacimiento}" />
                </div>
                <div class="form-group col-md-4">
                  <label>Identificaci√≥n:</label>
                  <select class="form-control" name="identificacion" [(ngModel)]="identificacion"
                    [ngClass]="{'campo-rojo': formulario && formulario.identificacion}">
                    <option *ngFor="let item of identificaciones" [value]="item.ididentificacion">{{ item.descripcion }}
                    </option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label>N√∫mero de Identificaci√≥n:</label>
                  <input type="text" class="form-control" name="numerodeidentificacion"
                    [(ngModel)]="numerodeidentificacion"
                    [ngClass]="{'campo-rojo': formulario && formulario.numerodeidentificacion}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>G√©nero:</label>
                  <select class="form-control" name="genero" [(ngModel)]="genero"
                    [ngClass]="{'campo-rojo': formulario && formulario.genero}">
                    <option value="M">Masculino</option>
                    <option value="F">Femenino</option>
                    <option value="ND">No definido</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label>Ocupaci√≥n:</label>
                  <select class="form-control" name="ocupacion" [(ngModel)]="ocupacion"
                    [ngClass]="{'campo-rojo': formulario && formulario.ocupacion}" (change)="ocupacionvalidar($event)">
                    <option *ngFor="let item of ocupaciones" [value]="item.idacividad">{{ item.descripcion }}</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label>Tel√©fono:</label>
                  <input type="text" class="form-control" name="numerotelefono" [(ngModel)]="numerotelefono"
                    [ngClass]="{'campo-rojo': formulario && formulario.numerotelefono}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-6">
                  <label>Email:</label>
                  <input type="text" class="form-control" name="correoelectronico" [(ngModel)]="correoelectronico"
                    [ngClass]="{'campo-rojo': formulario && formulario.correoelectronico}" />
                </div>
                <div class="form-group col-md-3" *ngIf="sermexicano">
                  <label>CURP:</label>
                  <input type="text" class="form-control" name="curp" [(ngModel)]="curp"
                    [ngClass]="{'campo-rojo': formulario && formulario.curp}" />
                </div>
                <div class="form-group col-md-3" *ngIf="sermexicano">
                  <label>RFC:</label>
                  <input type="text" class="form-control" name="rfc" [(ngModel)]="rfc"
                    [ngClass]="{'campo-rojo': formulario && formulario.rfc}" />
                </div>
              </div>

              <div class="row g-3 mt-2" *ngIf="!sermexicano">
                <div class="form-group col-md-6">
                  <label>NIF:</label>
                  <input type="text" class="form-control" name="numeroidentificacionfiscal"
                    [(ngModel)]="numeroidentificacionfiscal"
                    [ngClass]="{'campo-rojo': formulario && formulario.numeroidentificacionfiscal}" />
                </div>
                <div class="form-group col-md-6">
                  <label>Pa√≠s:</label>
                  <input type="text" class="form-control" name="pais" [(ngModel)]="pais"
                    [ngClass]="{'campo-rojo': formulario && formulario.pais}" />
                </div>
              </div>
            </div>
          </div>

          <!-- üîπ DOMICILIO -->
          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light fw-bold">Domicilio</div>
            <div class="card-body">
              <div class="row g-3">
                <div class="form-group col-md-3">
                  <label>C√≥digo Postal:</label>
                  <input type="text" class="form-control" name="cp" [(ngModel)]="codigopostal"
                    (change)="consultarDespuesDe5Digitos($event)"
                    [ngClass]="{'campo-rojo': formulario && formulario.cp}" />
                </div>
                <div class="form-group col-md-3">
                  <label>Calle:</label>
                  <input type="text" class="form-control" name="calle" [(ngModel)]="calle"
                    [ngClass]="{'campo-rojo': formulario && formulario.calle}" />
                </div>
                <div class="form-group col-md-3">
                  <label>No. Interior:</label>
                  <input type="text" class="form-control" name="numerointerior" [(ngModel)]="numerointerior"
                    [ngClass]="{'campo-rojo': formulario && formulario.numerointerior}" />
                </div>
                <div class="form-group col-md-3">
                  <label>No. Exterior:</label>
                  <input type="text" class="form-control" name="numeroexterior" [(ngModel)]="numeroexterior"
                    [ngClass]="{'campo-rojo': formulario && formulario.numeroexterior}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4" *ngIf="sermexicano">
                  <label>Colonia:</label>
                  <select class="form-control" name="idcp" [(ngModel)]="idcp" (change)="seleccionarColonia($event)"
                    [ngClass]="{'campo-rojo': formulario && formulario.idcp}">
                    <option *ngFor="let item of colonias" [value]="item.id">{{ item.colonia }}</option>
                  </select>
                </div>
                <div class="form-group col-md-4" *ngIf="!sermexicano">
                  <label>Colonia:</label>
                  <input type="text" class="form-control" name="colonia" [(ngModel)]="colonia"
                    [ngClass]="{'campo-rojo': formulario && formulario.colonia}" />
                </div>
                <div class="form-group col-md-4">
                  <label>Municipio:</label>
                  <input type="text" class="form-control" name="municipio" [(ngModel)]="municipio"
                    [ngClass]="{'campo-rojo': formulario && formulario.municipio}" />
                </div>
                <div class="form-group col-md-4" *ngIf="sermexicano">
                  <label>Estado:</label>
                  <input type="text" class="form-control" name="estado" [(ngModel)]="estado"
                    [ngClass]="{'campo-rojo': formulario && formulario.estado}" />
                </div>
              </div>
            </div>
          </div>

          <!-- üîπ PERFIL TRANSACCIONAL -->
          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light fw-bold">Perfil Transaccional</div>
            <div class="card-body">

              <div class="row g-3">
                <div class="form-group col-md-4">
                  <label>Prop√≥sito de la relaci√≥n:</label>
                  <select class="form-control" name="proposito_relacion" [(ngModel)]="proposito_relacion">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let p of proposito" [value]="p.descripcion">{{ p.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Frecuencia de operaciones:</label>
                  <select class="form-control" name="frecuencia_operaciones" [(ngModel)]="frecuencia_operaciones">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let f of frecuencias" [value]="f.descripcion || f.frecuencia">
                      {{ f.descripcion || f.frecuencia }}
                    </option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Monto Promedio (MXN):</label>
                  <input type="number" class="form-control" name="monto_promedio" [(ngModel)]="monto_promedio" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Tipo de Operaciones:</label>
                  <select class="form-control" name="tipo_operaciones" [(ngModel)]="tipo_operaciones">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let t of tiposOperaciones" [value]="t.descripcion">{{ t.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Medio de Pago:</label>
                  <select class="form-control" name="medio_pago" [(ngModel)]="medio_pago">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let m of mediosPago" [value]="m.descripcion">{{ m.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Pa√≠ses de Operaci√≥n:</label>
                  <select class="form-control" name="paises_operaciones" [(ngModel)]="paises_operaciones">
                    <option *ngFor="let item of paises" [value]="item.codigo">{{ item.nombre }}</option>
                  </select>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>¬øAct√∫a en nombre de alguien?:</label>
                  <select class="form-control" name="actua_en_nombre" [(ngModel)]="actua_en_nombre">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let a of actuaNombres" [value]="a.descripcion">{{ a.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4" *ngIf="actua_en_nombre === 'Tercero'">
                  <label>Nombre del Tercero:</label>
                  <input type="text" class="form-control" name="tercero_nombre" [(ngModel)]="tercero_nombre" />
                </div>

                <div class="form-group col-md-4">
                  <label>¬øEs PEP?:</label>
                  <select class="form-control" name="es_pep" [(ngModel)]="es_pep">
                    <option [ngValue]="false">No</option>
                    <option [ngValue]="true">S√≠</option>
                  </select>
                </div>
              </div>

              <!-- üî∏ Campos nuevos -->
              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Origen de Recursos:</label>
                  <select class="form-control" name="origen_recursos" [(ngModel)]="origen_recursos">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let o of origenesRecursos" [value]="o.descripcion">{{ o.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Destino de Recursos:</label>
                  <select class="form-control" name="destino_recursos" [(ngModel)]="destino_recursos">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let d of destinosRecursos" [value]="d.descripcion">{{ d.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Monto mensual estimado:</label>
                  <input type="number" class="form-control" name="monto_mensual_estimado"
                    [(ngModel)]="monto_mensual_estimado" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Maneja fondos de terceros:</label>
                  <select class="form-control" name="maneja_fondos_terceros" [(ngModel)]="maneja_fondos_terceros">
                    <option [ngValue]="false">No</option>
                    <option [ngValue]="true">S√≠</option>
                  </select>
                </div>

                <div class="form-group col-md-4" *ngIf="maneja_fondos_terceros">
                  <label>Nombre del tercero:</label>
                  <input type="text" class="form-control" name="nombre_tercero_fondos"
                    [(ngModel)]="nombre_tercero_fondos" />
                </div>

                <div class="form-group col-md-4" *ngIf="maneja_fondos_terceros">
                  <label>Relaci√≥n con el tercero:</label>
                  <select class="form-control" name="relacion_tercero_fondos" [(ngModel)]="relacion_tercero_fondos">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let r of relacionesTercero" [value]="r.descripcion">{{ r.descripcion }}</option>
                  </select>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-6">
                  <label>Pa√≠s de procedencia de fondos:</label>
                  <select class="form-control" name="pais_procedencia_fondos" [(ngModel)]="pais_procedencia_fondos"
                    (change)="verificarCambio(pais_procedencia_fondos)">
                    <option *ngFor="let item of paises" [value]="item.codigo">{{ item.nombre }}</option>
                  </select>

                </div>

                <div class="form-group col-md-6">
                  <label>Pa√≠s destino de fondos:</label>
                  <select class="form-control" name="pais_destino_fondos" [(ngModel)]="pais_destino_fondos"
                    (change)="verificarCambio(pais_destino_fondos)">
                    <option *ngFor="let item of paises" [value]="item.codigo">{{ item.nombre }}</option>
                  </select>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-6">
                  <label>Cantidad de operaciones por mes:</label>
                  <input type="number" class="form-control" name="cantidad_operaciones_mes"
                    [(ngModel)]="cantidad_operaciones_mes" />
                </div>
              </div>

              <div class="form-group mt-3">
                <label>Comentarios:</label>
                <textarea class="form-control" rows="2" name="comentarios" [(ngModel)]="comentarios"></textarea>
              </div>

            </div>
          </div>



        </form>

        <div class="d-flex justify-content-between mt-4">
          <div>
            <button class="btn btn-primary" (click)="guardar()" *ngIf="info">Guardar</button>
            <button class="btn btn-success" (click)="actualizar()" *ngIf="!info">Actualizar</button>
          </div>
          <button class="btn btn-danger" (click)="cerrar(1)">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #will2="bs-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title" *ngIf="info == true">Agregar Usuario Empresa</h4>
        <h4 class="modal-title" *ngIf="info == false">Editar Usuario Empresa</h4>
      </div>

      <!-- ================= EMPRESA ================= -->
      <div class="modal-body row" *ngIf="visibleemp == false">
        <form class="form-responsive">
          <div class="card mb-4">
            <div class="card-header">Datos de la Empresa</div>
            <div class="card-body">
              <div class="row">
                <div class="form-group col">
                  <label for="razonsocial">Raz√≥n Social:</label>
                  <input type="text" class="form-control" name="razonsocial" [(ngModel)]="razonsocial" />
                </div>
              </div>

              <div class="row">
                <div class="form-group col">
                  <label for="nacionalidadempresa">Pais de Registro:</label>
                  <select class="form-control" name="nacionalidadempresa" [(ngModel)]="nacionalidadempresa"
                    [ngClass]="{'campo-rojo': formulario && formulario.paisnaci}">
                    <option *ngFor="let item of paises" [value]="item.idpais">{{ item.nombre }}</option>
                  </select>
                </div>

                <div class="form-group col">
                  <label for="rfcempresa">RFC o NIF:</label>
                  <input type="text" class="form-control" name="rfcempresa" [(ngModel)]="rfcempresa" />
                </div>

                <div class="form-group col">
                  <label for="rfcserie">N√∫mero de serie RFC:</label>
                  <input type="text" class="form-control" name="rfcserie" [(ngModel)]="rfcserie" />
                </div>
              </div>

              <div class="row">
                <div class="form-group col">
                  <label for="domiciliofiscal">Domicilio Fiscal:</label>
                  <input type="text" class="form-control" name="domiciliofiscal" [(ngModel)]="domiciliofiscal" />
                </div>
              </div>

              <div class="row">
                <div class="form-group col">
                  <label for="telefono">Tel√©fono:</label>
                  <input type="text" class="form-control" name="telefono" [(ngModel)]="telemp" />
                </div>

                <div class="form-group col">
                  <label for="correo">Correo:</label>
                  <input type="text" class="form-control" name="correo" [(ngModel)]="correoempr" />
                </div>

                <div class="form-group col">
                  <label for="fechaconst">Fecha de Constituci√≥n:</label>
                  <input type="date" class="form-control" name="fechaconst" [(ngModel)]="fechaconst" />
                </div>
              </div>

              <div class="row">
                <div class="form-group col">
                  <label for="actividad">Actividad:</label>
                  <input type="text" class="form-control" name="actividad" [(ngModel)]="actividad" />
                </div>

                <div class="form-group col">
                  <label for="numeroescritura">N√∫mero de Escritura:</label>
                  <input type="text" class="form-control" name="numeroescritura" [(ngModel)]="numeroescritura" />
                </div>

                <div class="form-group col">
                  <label for="foliomercantil">Folio Mercantil:</label>
                  <input type="text" class="form-control" name="foliomercantil" [(ngModel)]="foliomercantil" />
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light fw-bold">Domicilio</div>
            <div class="card-body">
              <div class="row g-3">
                <div class="form-group col-md-3">
                  <label>C√≥digo Postal:</label>
                  <input type="text" class="form-control" name="cp" [(ngModel)]="codigopostal"
                    (change)="consultacp($event)" [ngClass]="{'campo-rojo': formulario && formulario.cp}" />
                </div>
                <div class="form-group col-md-3">
                  <label>Calle:</label>
                  <input type="text" class="form-control" name="calle" [(ngModel)]="calle"
                    [ngClass]="{'campo-rojo': formulario && formulario.calle}" />
                </div>
                <div class="form-group col-md-3">
                  <label>No. Interior:</label>
                  <input type="text" class="form-control" name="numerointerior" [(ngModel)]="numerointerior"
                    [ngClass]="{'campo-rojo': formulario && formulario.numerointerior}" />
                </div>
                <div class="form-group col-md-3">
                  <label>No. Exterior:</label>
                  <input type="text" class="form-control" name="numeroexterior" [(ngModel)]="numeroexterior"
                    [ngClass]="{'campo-rojo': formulario && formulario.numeroexterior}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Colonia:</label>
                  <select class="form-control" name="idcp" [(ngModel)]="idcp" (change)="seleccionarColonia($event)"
                    [ngClass]="{'campo-rojo': formulario && formulario.idcp}">
                    <option *ngFor="let item of colonias" [value]="item.id">{{ item.colonia }}</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label>Municipio:</label>
                  <input type="text" class="form-control" name="municipio" [(ngModel)]="municipio"
                    [ngClass]="{'campo-rojo': formulario && formulario.municipio}" />
                </div>
                <div class="form-group col-md-4" *ngIf="sermexicano">
                  <label>Estado:</label>
                  <input type="text" class="form-control" name="estado" [(ngModel)]="estado"
                    [ngClass]="{'campo-rojo': formulario && formulario.estado}" />
                </div>
              </div>
            </div>
          </div>
          <!-- ============ PERFIL TRANSACCIONAL ============ -->

          <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light fw-bold">Perfil Transaccional</div>
            <div class="card-body">
              <div class="row g-3">
                <div class="form-group col-md-4">
                  <label>Prop√≥sito de la relaci√≥n:</label>
                  <select class="form-control" name="proposito_relacion" [(ngModel)]="proposito_relacion"
                    [ngClass]="{'campo-rojo': formulario && formulario.proposito_relacion}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let p of proposito" [value]="p.descripcion">{{ p.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Frecuencia de operaciones:</label>
                  <select class="form-control" name="frecuencia_operaciones" [(ngModel)]="frecuencia_operaciones"
                    [ngClass]="{'campo-rojo': formulario && formulario.frecuencia_operaciones}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let f of frecuencias" [value]="f.descripcion || f.frecuencia">
                      {{ f.descripcion || f.frecuencia }}
                    </option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Monto Promedio (MXN):</label>
                  <input type="number" class="form-control" name="monto_promedio" [(ngModel)]="monto_promedio"
                    [ngClass]="{'campo-rojo': formulario && formulario.monto_promedio}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Tipo de Operaciones:</label>
                  <select class="form-control" name="tipo_operaciones" [(ngModel)]="tipo_operaciones"
                    [ngClass]="{'campo-rojo': formulario && formulario.tipo_operaciones}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let t of tiposOperaciones" [value]="t.descripcion">{{ t.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Medio de Pago:</label>
                  <select class="form-control" name="medio_pago" [(ngModel)]="medio_pago"
                    [ngClass]="{'campo-rojo': formulario && formulario.medio_pago}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let m of mediosPago" [value]="m.descripcion">{{ m.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Pa√≠ses de Operaci√≥n:</label>
                  <input type="text" class="form-control" name="paises_operaciones" [(ngModel)]="paises_operaciones"
                    [ngClass]="{'campo-rojo': formulario && formulario.paises_operaciones}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>¬øAct√∫a en nombre de alguien?:</label>
                  <select class="form-control" name="actua_en_nombre" [(ngModel)]="actua_en_nombre"
                    [ngClass]="{'campo-rojo': formulario && formulario.actua_en_nombre}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let a of actuaNombres" [value]="a.descripcion">{{ a.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4" *ngIf="actua_en_nombre === 'Tercero'">
                  <label>Nombre del Tercero:</label>
                  <input type="text" class="form-control" name="tercero_nombre" [(ngModel)]="tercero_nombre"
                    [ngClass]="{'campo-rojo': formulario && formulario.tercero_nombre}" />
                </div>

                <div class="form-group col-md-4">
                  <label>¬øEs PEP?:</label>
                  <select class="form-control" name="es_pep" [(ngModel)]="es_pep"
                    [ngClass]="{'campo-rojo': formulario && formulario.es_pep}">
                    <option [ngValue]="false">No</option>
                    <option [ngValue]="true">S√≠</option>
                  </select>
                </div>
              </div>

              <!-- üî∏ Campos nuevos -->
              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Origen de Recursos:</label>
                  <select class="form-control" name="origen_recursos" [(ngModel)]="origen_recursos"
                    [ngClass]="{'campo-rojo': formulario && formulario.origen_recursos}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let o of origenesRecursos" [value]="o.descripcion">{{ o.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Destino de Recursos:</label>
                  <select class="form-control" name="destino_recursos" [(ngModel)]="destino_recursos"
                    [ngClass]="{'campo-rojo': formulario && formulario.destino_recursos}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let d of destinosRecursos" [value]="d.descripcion">{{ d.descripcion }}</option>
                  </select>
                </div>

                <div class="form-group col-md-4">
                  <label>Monto mensual estimado:</label>
                  <input type="number" class="form-control" name="monto_mensual_estimado"
                    [(ngModel)]="monto_mensual_estimado"
                    [ngClass]="{'campo-rojo': formulario && formulario.monto_mensual_estimado}" />
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-4">
                  <label>Maneja fondos de terceros:</label>
                  <select class="form-control" name="maneja_fondos_terceros" [(ngModel)]="maneja_fondos_terceros">
                    <option [ngValue]="false">No</option>
                    <option [ngValue]="true">S√≠</option>
                  </select>
                </div>

                <div class="form-group col-md-4" *ngIf="maneja_fondos_terceros">
                  <label>Nombre del tercero:</label>
                  <input type="text" class="form-control" name="nombre_tercero_fondos"
                    [(ngModel)]="nombre_tercero_fondos"
                    [ngClass]="{'campo-rojo': formulario && formulario.nombre_tercero_fondos}" />
                </div>

                <div class="form-group col-md-4" *ngIf="maneja_fondos_terceros">
                  <label>Relaci√≥n con el tercero:</label>
                  <select class="form-control" name="relacion_tercero_fondos" [(ngModel)]="relacion_tercero_fondos"
                    [ngClass]="{'campo-rojo': formulario && formulario.relacion_tercero_fondos}">
                    <option value="">Seleccione...</option>
                    <option *ngFor="let r of relacionesTercero" [value]="r.descripcion">{{ r.descripcion }}</option>
                  </select>
                </div>
              </div>
              <div class="row g-3 mt-2">
                <div class="form-group col-md-6">
                  <label>Pa√≠s de procedencia de fondos:</label>
                  <select class="form-control" name="paisnaci" [(ngModel)]="pais_procedencia_fondos"
                    [ngClass]="{'campo-rojo': formulario && formulario.pais_procedencia_fondos}">
                    <option *ngFor="let item of paises" [value]="item.codigo">{{ item.nombre }}</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <label>Pa√≠s destino de fondos:</label>
                  <select class="form-control" name="paisnaci" [(ngModel)]="pais_destino_fondos"
                    [ngClass]="{'campo-rojo': formulario && formulario.pais_destino_fondos}">
                    <option *ngFor="let item of paises" [value]="item.codigo">{{ item.nombre }}</option>
                  </select>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="form-group col-md-6">
                  <label>Cantidad de operaciones por mes:</label>
                  <input type="number" class="form-control" name="cantidad_operaciones_mes"
                    [(ngModel)]="cantidad_operaciones_mes"
                    [ngClass]="{'campo-rojo': formulario && formulario.cantidad_operaciones_mes}" />
                </div>
              </div>

              <div class="form-group mt-3">
                <label>Comentarios:</label>
                <textarea class="form-control" rows="2" name="comentarios" [(ngModel)]="comentarios"
                  [ngClass]="{'campo-rojo': formulario && formulario.comentarios}"></textarea>
              </div>
            </div>
          </div>

          <!-- BOTONES DE GUARDAR / ACTUALIZAR -->
          <div class="row mt-3">
            <div class="col-md-6">
              <button class="btn btn-primary w-100" *ngIf="info == true" (click)="guardarempresa()">Guardar
                Empresa</button>
              <button class="btn btn-warning w-100" *ngIf="info == false" (click)="actualizarempresa()">Actualizar
                Empresa</button>
            </div>
            <div class="col-md-6">
              <button class="btn btn-danger w-100" (click)="cerrar(2)">Cerrar</button>
            </div>
          </div>
        </form>
      </div>

      <!-- ====================================================== -->
      <!-- TABLA DE ACCIONISTAS -->
      <!-- ====================================================== -->
      <div class="card mt-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>Listado de Accionistas / Representantes / Apoderados</span>
          <button class="btn btn-success btn-sm" (click)="abrirModalAccionista()">Agregar</button>
        </div>

        <div class="card-body table-responsive">
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Tipo</th>
                <th>Correo</th>
                <th>Tel√©fono</th>
                <th>Ocupaci√≥n</th>
                <th>Riesgo</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let a of accionistas; let i = index">
                <td>{{ a.nombre }} {{ a.paterno }} {{ a.materno }}</td>
                <td>{{ a.tipopersona == 1 ? 'F√≠sica' : 'Moral' }}</td>
                <td>{{ a.correo }}</td>
                <td>{{ a.telefono }}</td>
                <td>{{ a.ocupacion_desc }}</td>
                <td>{{ a.riesgo }}</td>
                <td>
                  <button class="btn btn-warning btn-sm me-1" (click)="editarAccionista(a,i)">Editar</button>
                  <button class="btn btn-danger btn-sm" (click)="eliminarAccionista(a,i)">Eliminar</button>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="text-end mt-3">
            <button class="btn btn-primary" (click)="guardarclienteempresa()">Guardar Estructura</button>
          </div>
        </div>
      </div>

      <div class="text-end p-3">
        <button class="btn btn-danger" (click)="will2.hide(); limpiar()">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- ====================================================== -->
<!-- MODAL DE ACCIONISTA -->
<!-- ====================================================== -->
<div class="modal fade" bsModal #modalAccionista="bs-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ accionistaEditando ? 'Editar Accionista' : 'Agregar Accionista' }}</h5>
      </div>
      <div class="modal-body">
        <form>
          <div class="row mb-2">
            <div class="form-group col">
              <label>Tipo Persona:</label>
              <select class="form-control" [(ngModel)]="accionista.tipopersona" name="tipopersona">
                <option value="1">F√≠sica</option>
                <option value="2">Moral</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label>Nombre:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.nombre" name="nombre" />
            </div>
            <div class="form-group col" *ngIf="accionista.tipopersona == 1">
              <label>Paterno:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.paterno" name="paterno" />
            </div>
            <div class="form-group col" *ngIf="accionista.tipopersona == 1">
              <label>Materno:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.materno" name="materno" />
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label>Nacionalidad:</label>
              <select class="form-control" [(ngModel)]="accionista.nacionalidad" name="nacionalidad">
                <option *ngFor="let item of nacionalidades" [value]="item.idnaci">{{ item.nacionalidad }}</option>
              </select>
            </div>
            <div class="form-group col">
              <label>Ocupaci√≥n:</label>
              <select class="form-control" [(ngModel)]="accionista.ocupacion" name="ocupacion">
                <option *ngFor="let item of ocupaciones" [value]="item.idacividad">{{ item.descripcion }}</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label>Correo:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.correo" name="correo" />
            </div>
            <div class="form-group col">
              <label>Tel√©fono:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.telefono" name="telefono" />
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label>RFC:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.rfc" name="rfc" />
            </div>
            <div class="form-group col">
              <label>CURP:</label>
              <input type="text" class="form-control" [(ngModel)]="accionista.curp" name="curp" />
            </div>
          </div>
          <div class="row">
            <div class="form-group col">
              <label>Riesgo:</label>
              <select class="form-control" [(ngModel)]="accionista.riesgo" name="riesgo">
                <option value="Bajo">Bajo</option>
                <option value="Medio">Medio</option>
                <option value="Alto">Alto</option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" (click)="guardarAccionista()">
          {{ accionistaEditando ? 'Actualizar' : 'Guardar' }}
        </button>
        <button class="btn btn-danger" (click)="modalAccionista.hide()">Cerrar</button>
      </div>
    </div>
  </div>
</div>