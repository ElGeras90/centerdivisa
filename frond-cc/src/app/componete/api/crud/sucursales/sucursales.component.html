<div class="container mt-4 cuerpo">
    <div class="row align-items-center">
        <div class="col">
            <mat-form-field>
                <input matInput (keyup)="applyFilter($event)" placeholder="Buscar">
            </mat-form-field>
        </div>
        <div class="col" style="text-align: right;">
            <button class="btn btn-primary mt-3" (click)="abrirgurdar()">Agregar Sucursal</button>

        </div>


    </div>
    <div class="table-responsive">
       
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

            <ng-container matColumnDef="sucursales">
                <th mat-header-cell *matHeaderCellDef> Sucursal </th>
                <td mat-cell *matCellDef="let row"> {{row.nombre_sucursal}} </td>
            </ng-container>

            <ng-container matColumnDef="Activo">
                <th mat-header-cell *matHeaderCellDef> Activo </th>
                <td mat-cell *matCellDef="let row">
                    <mat-icon *ngIf="row.activa" class="activo-icon">check_circle</mat-icon>
                    <mat-icon *ngIf="!row.activa" class="inactivo-icon">cancel</mat-icon>
                </td>
            </ng-container>

            <!-- Columna Acciones -->
            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                <td mat-cell *matCellDef="let row">
                    <button mat-icon-button color="primary" (click)="actualizar(row)">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="eliminar(row)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <mat-paginator [pageSizeOptions]="[5, 10, 25, 50]" showFirstLastButtons></mat-paginator>
    </div>

</div>
<div class="modal fade" bsModal #will="bs-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
   <div class="modal-dialog modal-lg modal-dialog-centered">
  <div class="modal-content shadow-lg border-0 rounded-4 overflow-hidden">
    <!-- Header -->
    <div class="modal-header bg-primary text-white py-3">
      <h4 class="modal-title d-flex align-items-center mb-0">
        <i class="bi bi-shop me-2"></i>
        {{ info ? 'Agregar Sucursal' : 'Editar Sucursal' }}
      </h4>
      <button
        type="button"
        class="btn-close btn-close-white"
        (click)="will.hide()"
      ></button>
    </div>

    <!-- Body -->
    <div class="modal-body bg-light">
      <form class="form-responsive">
        <!-- Datos de Sucursal -->
        <div class="card border-0 shadow-sm rounded-3 mb-4">
          <div class="card-header bg-primary text-white fw-semibold">
            <i class="bi bi-building-fill-gear me-2"></i> Datos de la Sucursal
          </div>

          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-5">
                <label for="nombre_sucursal" class="form-label">Nombre de Sucursal</label>
                <input
                  type="text"
                  class="form-control"
                  id="nombre_sucursal"
                  [(ngModel)]="nombre_sucursal"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Ej. Sucursal Centro"
                />
              </div>

              <div class="col-md-5" *ngIf="idrol==1">
                <label for="empresaid" class="form-label">Empresa a la que pertenece</label>
                <select
                  class="form-select"
                  id="empresaid"
                  [(ngModel)]="empresaid"
                  [ngModelOptions]="{ standalone: true }"
                >
                  <option *ngFor="let item of empresas" [value]="item.idempresa">
                    {{ item.razonsocial }}
                  </option>
                </select>
              </div>

              <div class="col-md-2 d-flex align-items-center justify-content-center mt-4">
                <div class="form-check form-switch">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="activa"
                    [(ngModel)]="activa"
                    [ngModelOptions]="{ standalone: true }"
                  />
                  <label class="form-check-label fw-semibold" for="activa">Activa</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Dirección de la Sucursal -->
        <div class="card border-0 shadow-sm rounded-3">
          <div class="card-header bg-success text-white fw-semibold">
            <i class="bi bi-geo-alt-fill me-2"></i> Dirección de la Sucursal
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label">Código Postal</label>
                <input
                  type="text"
                  class="form-control"
                  maxlength="5"
                  [(ngModel)]="codigopostal"
                  (input)="consultarDespuesDe5Digitos()"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Ej. 97000"
                />
              </div>

              <div class="col-md-5">
                <label class="form-label">Calle</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="calle"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Nombre de la calle"
                />
              </div>

              <div class="col-md-4">
                <label class="form-label">Número</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="numero"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Ej. 125 o S/N"
                />
              </div>
            </div>

            <div class="row g-3 mt-3">
              <div class="col-md-4">
                <label class="form-label">Colonia</label>
                <select
                  class="form-select"
                  [(ngModel)]="idcp"
                  (change)="seleccionarColonia($event)"
                  [ngModelOptions]="{ standalone: true }"
                >
                  <option value="">Seleccione una colonia</option>
                  <option *ngFor="let item of colonia" [value]="item.id">
                    {{ item.colonia }}
                  </option>
                </select>
              </div>

              <div class="col-md-4">
                <label class="form-label">Municipio</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="municipio"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Nombre del municipio"
                />
              </div>

              <div class="col-md-4">
                <label class="form-label">Estado</label>
                <input
                  type="text"
                  class="form-control"
                  [(ngModel)]="estado"
                  [ngModelOptions]="{ standalone: true }"
                  placeholder="Nombre del estado"
                />
              </div>
            </div>
          </div>
        </div>
      </form>

      <!-- Botones de acción -->
      <div class="d-flex justify-content-between align-items-center mt-4">
        <button
          class="btn btn-primary px-4"
          *ngIf="info == true"
          (click)="guardarsucursal()"
        >
          <i class="bi bi-save me-2"></i> Guardar
        </button>

        <button
          class="btn btn-warning text-white px-4"
          *ngIf="info == false"
          (click)="actualizarsucursal()"
        >
          <i class="bi bi-pencil-square me-2"></i> Actualizar
        </button>

        <button class="btn btn-danger px-4" (click)="will.hide()">
          <i class="bi bi-x-circle me-2"></i> Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

</div> 