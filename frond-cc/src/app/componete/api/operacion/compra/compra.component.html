<div class="container-fluid cuerpo bg-light min-vh-100 py-4">
  <!-- Encabezado -->
  <div class="row align-items-center mb-4 border-bottom pb-3">
    <div class="col-md-6">
      <h3 class="fw-bold text-primary mb-0">
        <i class="bi bi-person-circle me-2"></i>Usuario: {{ nombreusuario }}
      </h3>
    </div>
    <div class="col-md-6 text-end">
      <h5 class="text-muted mb-0">
        <i class="bi bi-calendar3 me-2"></i>{{ formattedDate }}
      </h5>
    </div>
  </div>

  <!-- Saldo -->
  <div class="row justify-content-end mb-4">
    <div class="col-auto">
      <div class="card shadow-sm border-0 bg-white px-4 py-2">
        <p class="mb-0 fw-semibold text-secondary">
          Saldo en Moneda Nacional:
          <span class="text-success fw-bold">{{ saldomn | currency:'MXN' }}</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Tarjeta principal -->
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-7 col-lg-5">
        <div class="card shadow-lg border-0 rounded-4 p-4 bg-white">
          <div class="text-center mb-4">
            <h4 class="fw-bold text-dark mb-1">Operación de Compra</h4>
            <p class="text-muted small mb-0">Seleccione la divisa y los datos correspondientes</p>
          </div>
          <form #f="ngForm">

            <!-- Divisa -->
            <div class="form-group mb-3">
              <label for="divisa" class="fw-semibold">Divisa</label>
              <select class="form-select" id="divisa" [(ngModel)]="compra" name="compra" (change)="captura($event)" required
                [ngClass]="{'is-invalid': f.submitted && compra == 0}">
                <option value="0">Seleccione una opción</option>
                <option *ngFor="let a of divisas" [value]="a.iddivisa">{{ a.grupo }}</option>
              </select>
              <div class="invalid-feedback">Debes seleccionar una divisa válida.</div>
            </div>

            <!-- Cantidad -->
            <div class="form-group mb-3">
              <label for="cantidad" class="fw-semibold">Cantidad</label>
              <input type="number" class="form-control" id="cantidad" placeholder="Ingresa cantidad" step="0.01"
                [(ngModel)]="cambio" name="cantidad" required min="0.01" [value]="cambio"
                [ngClass]="{'is-invalid': f.submitted && ( !cambio || cambio <= 0 )}" (input)="convertir($event)">
              <div class="invalid-feedback">La cantidad debe ser mayor a 0.</div>
            </div>

            <!-- Cotización (bloqueado) -->
            <div class="form-group mb-3">
              <label for="cotizacion" class="fw-semibold">Cotización</label>
              <input type="number" class="form-control" id="cotizacion" [value]="cotizacion" placeholder="Ingresa cotización" step="0.01"
                [value]="cotizacion" readonly>
            </div>

            <!-- Importe (bloqueado) -->
            <div class="form-group mb-3">
              <label for="importe" class="fw-semibold">Importe</label>
              <input type="number" class="form-control" id="importe" placeholder="Resultado del cálculo"
                [value]="resultado" readonly>
            </div>

            <!-- Instrumento -->
            <div class="form-group mb-4">
              <label for="instrumento" class="fw-semibold">Instrumento de Pago</label>
              <select class="form-select" id="instrumento" [(ngModel)]="instrumento" name="instrumento" required
                [ngClass]="{'is-invalid': f.submitted && instrumento == 0}">
                <option value="0" selected>Seleccione una opción</option>
                <option *ngFor="let a of instrumentos" [value]="a.idtipo">{{ a.descripcion }}</option>
              </select>
              <div class="invalid-feedback">Debes seleccionar un instrumento de pago.</div>
            </div>

            <!-- Botón -->
            <div class="d-grid">
              <button type="button" class="btn btn-primary btn-lg rounded-pill shadow-sm" (click)="verificar()"
                [disabled]="compra == 0 || !cambio || cambio <= 0 || instrumento == 0">
                <i class="bi bi-calculator me-2"></i>Calcular
              </button>
            </div>

          </form>


        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" bsModal #will="bs-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">

      </div>
      <div class="modal-body row">
        <app-clientes [formulario]="formulario" [status]="true"
          (respuestaEnviada)="manejarRespuesta($event)"></app-clientes>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #enviocorrecto="bs-modal" tabindex="-1" role="dialog"
  aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen">
    <div class="modal-content border-0 rounded-4 shadow-lg bg-gradient-light">

      <!-- Encabezado -->
      <div class="modal-header bg-primary text-white rounded-top-4 py-3">
        <h4 class="modal-title fw-bold mb-0">
          <i class="bi bi-check-circle-fill me-2"></i>
          Cobro realizado con éxito
        </h4>
      </div>

      <!-- Cuerpo -->
      <div class="modal-body d-flex flex-column align-items-center justify-content-center p-5 bg-light-subtle">
        <div class="text-center mb-5">
          <p class="fs-5 text-muted mb-0">
            Selecciona una opción para continuar
          </p>
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-5">

          <!-- Opción: Ticket Agente -->
          <div class="op-card text-center p-4 rounded-4 shadow-sm bg-white">
            <div class="icon-wrapper mb-3 bg-primary bg-opacity-10 rounded-circle d-inline-flex p-4">
              <i class="bi bi-printer-fill text-primary fs-1"></i>
            </div>
            <h5 class="fw-semibold text-dark mb-3">Ticket Agente</h5>
            <p class="text-secondary small mb-4">
              Genera e imprime el ticket correspondiente al agente
            </p>
            <button class="btn btn-primary px-4 py-2 rounded-pill shadow-sm fw-semibold"
              (click)="printTicket(numeroFormateado)">
              <i class="bi bi-receipt me-2"></i> Imprimir Ticket
            </button>
          </div>

          <!-- Opción: Cerrar -->
          <div class="op-card text-center p-4 rounded-4 shadow-sm bg-white">
            <div class="icon-wrapper mb-3 bg-danger bg-opacity-10 rounded-circle d-inline-flex p-4">
              <i class="bi bi-x-circle-fill text-danger fs-1"></i>
            </div>
            <h5 class="fw-semibold text-dark mb-3">Cerrar</h5>
            <p class="text-secondary small mb-4">
              Finaliza la operación y regresa al panel principal
            </p>
            <button class="btn btn-outline-danger px-4 py-2 rounded-pill fw-semibold shadow-sm" (click)="cerrar1()">
              <i class="bi bi-door-closed-fill me-2"></i> Cerrar
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>